name: Update Lead Contact Status

on:
  schedule:
    # Run every day at 5:00 AM UTC (adjust timezone as needed)
    - cron: '0 5 * * *'

  workflow_dispatch:
    # Allow manual triggering from GitHub UI

permissions:
  issues: write
  contents: read

jobs:
  update-leads:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup GitHub CLI
        run: |
          type -p gh >/dev/null || (curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg \
          && sudo chmod go+r /usr/share/keyrings/githubcli-archive-keyring.gpg \
          && echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null \
          && sudo apt update \
          && sudo apt install gh -y)

      - name: Authenticate GitHub CLI
        run: |
          echo "${{ secrets.GH_PAT }}" | gh auth login --with-token

      - name: Update lead contact status
        run: |
          chmod +x .github/scripts/update_lead_status.sh
          .github/scripts/update_lead_status.sh
        env:
          GH_TOKEN: ${{ secrets.GH_PAT }}

      - name: Summary
        run: |
          echo "âœ… Lead contact status updated successfully"
          echo "Check the logs above for details on which leads need follow-up"
